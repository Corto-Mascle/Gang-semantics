\documentclass[a4paper,UKenglish,cleveref, autoref, thm-restate]{lipics-v2021}
%This is a template for producing LIPIcs articles. 
%See lipics-v2021-authors-guidelines.pdf for further information.
%for A4 paper format use option "a4paper", for US-letter use option "letterpaper"
%for british hyphenation rules use option "UKenglish", for american hyphenation rules use option "USenglish"
%for section-numbered lemmas etc., use "numberwithinsect"
%for enabling cleveref support, use "cleveref"
%for enabling autoref support, use "autoref"
%for anonymousing the authors (e.g. for double-blind review), add "anonymous"
%for enabling thm-restate support, use "thm-restate"
%for enabling a two-column layout for the author/affilation part (only applicable for > 6 authors), use "authorcolumns"
%for producing a PDF according the PDF/A standard, add "pdfa"

%\pdfoutput=1 %uncomment to ensure pdflatex processing (mandatatory e.g. to submit to arXiv)
%\hideLIPIcs  %uncomment to remove references to LIPIcs series (logo, DOI, ...), e.g. when preparing a pre-final version to be uploaded to arXiv or another public repository

%\graphicspath{{./graphics/}}%helpful if your graphic files are in another directory

\bibliographystyle{plainurl}% the mandatory bibstyle
%\title{On deadlock avoidance control for lock-sharing systems} 
\title{Broadcast networks with local registers}

%\titlerunning{Dummy short title} %TODO optional, please use if title is longer than one line

%\author{Jane {Open Access}}{Dummy University Computing Laboratory, [optional: Address], Country \and My second affiliation, Country \and \url{http://www.myhomepage.edu} }{johnqpublic@dummyuni.org}{https://orcid.org/0000-0002-1825-0097}{(Optional) author-specific funding acknowledgements}%TODO mandatory, please use full name; only 1 author per \author macro; first two parameters are mandatory, other parameters can be empty. Please provide at least the name of the affiliation and the country. The full address is optional. Use additional curly braces to indicate the correct name splitting when the last name consists of multiple name parts.

%\author{Joan R. Public\footnote{Optional footnote, e.g. to mark corresponding author}}{Department of Informatics, Dummy College, [optional: Address], Country}{joanrpublic@dummycollege.org}{[orcid]}{[funding]}

\author{Lucie Guillou}{IRIF, Université de Paris}{}{}{}
\author{Corto Mascle}{LaBRI, Université de Bordeaux}{}{}{}
\author{Nicolas Waldburger}{IRISA, Universit\'e de Rennes}{}{}{}

\authorrunning{L. Guillou, C. Mascle, N. Waldburger} %TODO mandatory. First: Use abbreviated first/middle names. Second (only in severe cases): Use first author plus 'et al.'

\Copyright{Lucie Guillou, Corto Mascle and Nicolas Waldburger} %TODO mandatory, please use full first names. LIPIcs license is "CC-BY";  http://creativecommons.org/licenses/by/3.0/

%\ccsdesc[100]{\textcolor{red}{Replace ccsdesc macro with valid one}}
%%TODO mandatory: Please choose ACM 2012 classifications from
%%https://dl.acm.org/ccs/ccs_flat.cfm

\begin{CCSXML}
	<ccs2012>
	<concept>
	<concept_id>10003752.10003753.10003761.10003763</concept_id>
	<concept_desc>Theory of computation~Distributed computing models</concept_desc>
	<concept_significance>500</concept_significance>
	</concept>
	</ccs2012>
\end{CCSXML}

\ccsdesc[500]{Theory of computation~Distributed computing models}

% \ccsdesc{Theory of computation~Models of computation~Concurrency~Distributed computing models}

\keywords{parameterized verification, concurrent systems, well quasi-orders} %TODO mandatory; please add comma-separated list of keywords



%\category{} %optional, e.g. invited paper

%\relatedversion{} %optional, e.g. full version hosted on arXiv, HAL, or other respository/website
%\relatedversiondetails[linktext={opt. text shown instead of the URL}, cite=DBLP:books/mk/GrayR93]{Classification (e.g. Full Version, Extended Version, Previous Version}{URL to related version} %linktext and cite are optional

%\supplement{}%optional, e.g. related research data, source code, ... hosted on a repository like zenodo, figshare, GitHub, ...
%\supplementdetails[linktext={opt. text shown instead of the URL}, cite=DBLP:books/mk/GrayR93, subcategory={Description, Subcategory}, swhid={Software Heritage Identifier}]{General Classification (e.g. Software, Dataset, Model, ...)}{URL to related version} %linktext, cite, and subcategory are optional

%\funding{(Optional) general funding statement \dots}%optional, to capture a funding statement, which applies to all authors. Please enter author specific funding statements as fifth argument of the \author macro.

%\acknowledgements{I want to thank \dots}%optional

%\nolinenumbers %uncomment to disable line numbering



%Editor-only macros:: begin (do not touch as author)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \EventEditors{John Q. Open and Joan R. Access}
% \EventNoEds{2}
% \EventLongTitle{42nd Conference on Very Important Topics (CVIT 2016)}
% \EventShortTitle{CVIT 2016}
% \EventAcronym{CVIT}
% \EventYear{2016}
% \EventDate{December 24--27, 2016}
% \EventLocation{Little Whinging, United Kingdom}
% \EventLogo{}
% \SeriesVolume{42}
\ArticleNo{1}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




\newcommand{\cortoin}[1]{\todo[color=blue!20,inline]{\small #1}}
\newcommand{\corto}[1]{\todo[color=blue!20]{\small #1}}

\newcommand{\nicoin}[1]{\todo[color=red!20,inline]{\small #1}}
\newcommand{\nico}[1]{\todo[color=red!20]{\small #1}}

\newcommand{\luin}[1]{\todo[color=teal!20,inline]{\small #1}}
\newcommand{\lu}[1]{\todo[color=teal!20]{\small #1}}

\newif\ifproofs
\proofsfalse

\newif\ifintuition
\intuitionfalse


\input{General-preamble} 
\input{../kl}

%\renewcommand{\Target}{\textsc{Target}}

\begin{document}
	The  problem \Target~asks whether, given a protocol $\prot = (Q, \messages, \transitions, q_0)$ and a state $q_f \in Q$, there exists a run $\run = \config_0 \step{*} \config_f$ where, for all $a \in \agentsof{\run}$, $\config_f(a) = q_f$.
	
	
	\begin{theorem}
		In the general case, \Target~is undecidable.
	\end{theorem}
	\begin{proof}
		To prove this theorem, one can show that there exists a reduction of the \emph{halting problem} in Minsky machines to \Target~in BNRA. A Minsky Machine is a tuple $M= (\Loc, \Delta, \Cpt, \ell_0, \ell_f)$ where $\Loc$ is a finite set of locations, $\Cpt = \{\cpt_1, \cpt_2\}$ is a set of two counters, $\Delta \subseteq \Loc \times (\{\dec{\cpt}\}_{\cpt \in \Cpt} \cup \{\inc{\cpt}\}_{\cpt \in \Cpt} \cup \{\testz{\cpt}\}_{\cpt \in \Cpt} ) \times \Loc$ is a finite set of transitions, $\ell_0 \in \Loc$ is an initial location, and $\ell_f \in \Loc$ is a final location. A \emph{configuration} of a Minsky machine is a tuple $(\ell, v_1, v_2) \in \Loc \times \nats \times \nats$ where $v_1$ (resp. $v_2$) stands for the value of the counter $\cpt_1$ (resp. $\cpt_2$). The initial configuration is the configuration $(\ell_0, 0, 0)$.
		For two configurations $(\ell, v_1, v_2)$ and  $(\ell', v'_1, v'_2)$ and a transition $\delta \in \Delta$, we note $(\ell, v_1, v_2) \stepMM{\delta} (\ell', v'_1, v'_2)$ if one of the following condition holds:
		\begin{itemize}
			\item $\delta = (\ell, \inc{\cpt_i}, \ell')$ and $v'_i = v_i+1$, $v_{3-i} = v'_{3-i}$;
			\item $\delta = (\ell, \dec{\cpt_i}, \ell')$ and $v'_i = v_i-1$, $v_{3-i} = v'_{3-i}$;
			\item $\delta = (\ell, \testz{\cpt_i}, \ell')$ and $v'_i = v_i = 0$, $v_{3-i} = v'_{3-i}$.
		\end{itemize}
	We will note $\stepMM{}$ for $\bigcup_{\delta \in \Delta} \stepMM{\delta}$. 
	An execution of the machine is a sequence $(\ell_1, v_1^1, v_2^1) \stepMM{} (\ell_2, v_1^2, v_2^2) \stepMM{} \dots \stepMM{} (\ell_k, v_1^k, v_2^k)$. We say that an execution is initial if it starts with the initial configuration.
		The \emph{halting problem} asks whether there exists an initial execution ending with a configuration $(\ell_f, v_1, v_2)$ where $v_1$, $v_2$ are any values in $\nats$. This problem is well-known to be undecidable.
		\luin{to make the proof easier, one might require that there is no two transitions doing the same operation from a same location, this does not change the undecidability}
		
		
		\luin{construction}
		
		
		\begin{lemma}
			If there exists an initial execution in $M$ ending in $(\ell_f, v_1, v_2)$ for $v_1, v_2 \in \nats$, then there exists a run $\rho = \config_0 \step{*} \config_f$ with $\config_f(a) = q_f$ for all $a \in \agentsof{\rho}$.
		\end{lemma}
		
		\begin{proof}
			\luin{for now there is no intuition in this proof, please feel free to add whatever }
			Assume there is an initial execution $(\ell_0, 0, 0) \stepMM{\delta_1} (\ell_1, v_1^1, v_2^1) \stepMM{\delta_2} \dots \stepMM{\delta_k} (\ell_k, v_1^k, v_2^k)$ such that $\ell_k = \ell_f$, and note $N = \max_{1 \leq i \leq k}(v_1^i + v_2^i)$. Consider an initial configuration of $\prot$ with $N+ 1$ agents $\config_0$. We note $\agents = \{1, \dots, N+1\}$. From this initial configuration, we let the agent 1 takes the transition $(q_0, \br{m}{1}, q_1)$, and we choose this message to be received by the agent 2 only, with the transition $(q_0, \rec{m}{2}{\enregact}, q_2)$. This way, we construct $\config_1$ such that $\config_1(1) = (q_1, \data{\config_0}(1))$, $\st{\config_1}(2) =q_2$, $\data{\config_1}(2,2) = \data{\config_1}(1,1)$ and $\data{\config_1}(2,1) = \data{\config_0}(2,1)$. Note that for all other agents $a$, $\config_1(a) = \config_0(a)$. Now we will construct a sequence of configurations in the following way: for $1 \leq i < N$, from $\config_i$, agent $(i+1)$ takes the transition $(q_2, \br{m}{1}, q_3)$ and agent $(i+2)$ takes the transition $(q_0, \rec{m}{2}{\enregact}, q_2)$. One can prove by induction that $\config_1 \stepMM{} \config_2 \stepMM{} \dots \stepMM{} \config_N$ and that for all $1 \leq i \leq N$, and for all $j \in \agents$:
			\begin{itemize}
				\item if $j = 1$, $\st{\config_i}(j) = q_1$,
				\item if $1 < j \leq i$, $\st{\config_i}(j) = q_3$, and $\data{\config_i}(j,2) = \data{\config_i}(j-1,1)$
				\item if $j = i+1$, $\st{\config_i}(k) = q_2$, and $\data{\config_i}(j,2) = \data{\config_i}(j-1,1)$,
				\item if $j > i+1$, $\st{\config_i}(j) = q_0$.
			\end{itemize}
		\luin{proof by induction here}
		Finally, from $\config_N$ there is a last step before starting to simulate the execution of the machine: agent $(N+1)$ takes the transition $(q_2, \br{m}{1}, q_3)$ and agent 1 the transition $(q_1, \rec{m}{2}{\enregact}, \ell_0)$ reaching the configuration $\config'_{0}$ where $\config'_0$ is such that: $\forall i \in \agents$, if $i = 1$, $\st{\config'_0}(i) = \ell_0$, otherwise, $\st{\config'_0}(i) = q_3$, and $\data{\config'_0}(i, 2) = \data{\config'_0}((i+1)\%(N+1), 1)$. Note that, by construction, for all agent $i,j  \in \agents$ with $i \ne j$, $\data{\config'_0}(i, 1) \ne \data{\config'_0}(j,1)$.
		\luin{here add a figure to illustrate the situation of the agents }
		
		From $\config'_0$, we can start to simulate the execution between $(\ell_0, 0, 0)$ and $(\ell_k, v_1^k , v_2^k )$. We will do so by induction: we shall build a path from $\config'_0$ to $\config'_i$ for $0\leq i\leq k$, where $\config'_i$ is such that:  
		\begin{itemize}
			\item $\st{\config'_i}(1) = \ell_i$,
			\item there exists $x_1, \dots x_{v_1^i} \in \agents$ such that $\st{\config'_i}(x_j) = q_5$ for all $1 \leq j \leq v_1^i$;
			\item there exists $y_1, \dots y_{v_2^i} \in \agents$ such that $\st{\config'_i}(y_j) = q_6$ for all $1 \leq j \leq v_2^i$;
			\item for all $a \in \agents \setminus \{1, x_1, \dots, x_{v_1^i}, y_1, \dots y_{v_2^i}\}$, $\st{\config'_i}(a) = q_3$;
			\item $\data{\config'_i} = \data{\config'_0}$.
		\end{itemize} 
	For $i =0$, the construction is trivial as $\gamma'_0$ satisfies the desired properties.
	
		
	In the rest of this proof keep in mind that for any agent $a \in \agents$, and any configuration $\config$ that we will build, $\data{\config}(a,1) = \data{\config}((a+1)\%(N+1),2)$.\\
	
		\textbf{Construction of $\gamma'_{i+1}$.}
		We assume $\delta_{i+1} = (\ell_i, \inc{x_1}, \ell_{i+1})$, by definition of $N$, we observe that, as a consequence $v_1^i + v_2^i < N$, and so, by induction hypothesis, there exists $a \in \agents$ such that $\st{\config'_i}(a) = q_3$. We note $a_{\mathtt{new}}$ the minimal agent in such a state in $\config'_i$, formally $a_{\mathtt{new}} = \min_{a \in \agents}(\st{\config'_i}(a) = q_3)$. In the following we note $\delta = \delta_{i+1}$. From $\config'_i$, we build the path $\config_{1} \step{} \config_{2} \step{} \dots \step{} \config_{N+1}$, where $\config_{1} = \config'_i$ and for all $2 \leq j \leq N+1$:
		\begin{itemize}
			\item if $j< a_{\mathtt{new}}$, $\st{\config_j}(j) = (q, \mathtt{inc1})$ where $q = \st{\config_{j-1}}(j)$, 
			\item if $j> a_{\mathtt{new}}$, $\st{\config_j}(j) = (q, \mathtt{Dinc1})$ where $q = \st{\config_{j-1}}(j)$,
			\item if $j = a_{\mathtt{new}}$, $\st{\config_j}(j) = q_7$;
			\item for all $2 \leq k < j$, if $k\ne a_{\mathtt{new}}$, $\st{\config_j}(k) = q$ where $q = \st{\config_{1}}(j)$, otherwise $\st{\config_j}(k) = q_5$;
			\item for all $k > j$,  $\st{\config_j}(k) = \st{\config_1}(k)$;
			\item $\st{\config_j}(1) = q_\delta$;
			\item $\data{\config_j}= \data{\config_1}$.
		\end{itemize}
		We will first see how to build $\config_2$ from $\config_1$ and then how to build $\config_{j+1}$ from $\config_j$.
		\begin{itemize}
			\item\textbf{$\config_2$ from $\config_1$:} agent 1 takes the transition $(\ell_i, \br{\mathtt{inc1}}{1}, q_{\delta})$, and (i) if $a_{\mathtt{new}} \ne 2$, agent 2 takes the transition $(q, \rec{\mathtt{inc1}}{2}{=}, (q,\mathtt{inc1}))$ where $q = \st{\config_1}(2)$, (ii) otherwise, agent 2 takes the transition $(q_3, \rec{\mathtt{inc1}}{2}{=}, q_7)$.
			
			\item\textbf{$\config_{j+1}$ from $\config_j$ when $j= a_{\mathtt{new}}$:} the agent $j$ takes the transition $(q_7, \br{\mathtt{Dinc1}}{1}, q_5)$ and the agent $j+1$ takes the transition $(q, \rec{\mathtt{Dinc1}}{2}{=}, (q,\mathtt{Dinc_1}))$ where $q = \st{\config_j}(j+1)$. Note that, as $j = a_{\mathtt{new}}$, $j+1 \not = a_{\mathtt{new}}$.
			
			\item\textbf{$\config_{j+1}$ from $\config_j$ when $j \ne a_{\mathtt{new}}$:} the agent $j$ takes the transition $((q,m), \br{m}{1}, q)$ where $q = \st{\config_1}(j)$, $m \in \{\mathtt{inc1}, \mathtt{Dinc1}\}$ and $(q,m) = \st{\config_{j}}(j)$. If $j+1 \ne a_{\mathtt{new}}$, agent $j+1$ takes the transition $(q, \rec{m}{2}{=}, (q,m))$ if $j+1$ where $q = \st{\config_j}(j+1)$, otherwise it takes the transtion $(q_3, \rec{m}{2}{=}, q_7)$. Note that if $j+1 = a_{\mathtt{new}}$, then $m = \mathtt{inc1}$, $a_{\mathtt{new}}$ is the first agent to send the message $\mathtt{Dinc1}$ in the path.
		\end{itemize}
		Finally, in order to finish the construction of $\config'_{i+1}$, what is left to show is how to go from $\gamma_{N+1}$ to $\gamma'_{i+1}$. We do so in the following way: from $\gamma_{N+1}$ the agent $N+1$ is either on state $q_7$ if $a_{\mathtt{new}} = N+1$, either on a state $(q,\mathtt{Dinc1})$ where $q = \st{\config_1}(N+1)$. From $\gamma_{N+1}$, agent $N+1$ takes either a transition $(q_7, \br{\mathtt{Dinc1}}{1}, q_5)$ if $a_{\mathtt{new}} = N+1$, either a transition $((q,\mathtt{Dinc1}), \br{\mathtt{Dinc1}}{1}, q)$. Hence, agent 1 can take the transition $(q_\delta, \rec{\mathtt{Dinc}}{2}{=}, \ell_{i=1})$ (recall that $\data{\gamma_{N+1}}(1,2) = \data{\gamma_1}(1,2) = \data{\gamma'_0}(1,2) = \data{\gamma'_0}(N+1,1) = \data{\gamma_{N+1}}(N+1,1)$). The reached configuration is $\gamma'_{i+1}$. 
		
		One can verify that the only agent $a \in \agents \setminus \{1\}$ for which $\st{\gamma'_i}(a) \not = \st{\gamma'_{i+1}}(a)$ is $a_{\mathtt{new}}$ and its new state is $q_5$. From this, we conclude that $\gamma'_{i+1}$ satisfies the desired properties.
		%: $\st{\gamma'_{i+1}}(1) = \ell_{i+1}$, there exists $x_1, \dots, x_{v_1^i} , x_{v_1^{i+1}}\in \agents$  ($x_{v_1^{i+1}} = a_{\mathtt{new}}$) such that $\st{\gamma'_{i+1}}(x_j) = q_5$ for all $1 \leq j \leq v_1^i$, 
		
		The proof is done in an analogous way when $\delta_{i+1} = (\ell_i, \dec{\cpt_1}, \ell_{i+1})$ (this time $a_{\mathtt{new}}$ will be the first agent present on the state $q_5$) and of course the same can be done for increments and decrements on $\cpt_2$.
		
		When it comes to test to 0 of the counter $\cpt_1$, the transmitted message will be the same during all the path between $\gamma'_i$ and $\gamma'_{i+1}$. As by induction hypothesis, all agents are either on state $q_3$ or $q_6$, every agent will be able to receive and broadcast the message $\mathtt{test1}$. \lu{est ce que l'on veut écrire formellement ce cas là également ?}\\
		
		\luin{end of the proof}
		
		Now that we have build the path $\gamma'_0 \step{*} \gamma'_k$, it is easy to complete the execution to reach a configuration in wich all agents have local state $\ell_f$. Indeed, by construction $\st{\gamma'_k}(1) = \ell_f$. Hence, agent 1 can broadcast the message $\mathtt{f}$, received by agent 2, agent 2 then reaches $\ell_f$, and so on until all agents are on state $\ell_f$.\lu{more formal?} 
		\end{proof}
		
		\begin{lemma}
			If there exists a run $\rho = \config_0 \step{*} \config_f$ with $\config_f(a) = q_f$ for all $\agentsof{\rho}$, then there exists an initial execution in $M$ ending in $(\ell_f, v_1, v_2)$ for $v_1, v_2 \in \nats$.
		\end{lemma}
		

	\end{proof}
\end{document}