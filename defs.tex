\section{Definitions}

\begin{definition}
	A ""protocol"" is a tuple $(Q, \D, q_0)$ over an alphabet $\S$ with $Q$ a finite set of states, $q_0 \in Q$ an initial state, and $\D \subseteq Q \times \set{\br, \rec(*), \rec(\cp), \rec(\testeq)} \times Q$.
\end{definition}

\begin{definition}
	Let $(Q,\D, q_0)$ be a protocol, and $A$ a finite set of \emph{agents}.
	A ""configuration"" is a labelling function $\g : A \to Q \times \nats$, associating a state and a register value to each agent. We write $\g^Q$ for the state component of $\g$ and $\g^R$ for its register component.
	An \emph{initial configuration} $\g$ is one where for all $a \in A$, $\g^Q(a) = q_0$ and for all $a, a' \in A$, if $\g(a) = \g(a')$ then $a=a'$.
	
	\AP Given two configurations $\g$ and $\g'$, a ""transition"" $\g 
	\act{m} \g'$ between two configurations is defined when there exists $a_0 \in A$ such that $\g^Q(a_0) \act{\br} \g'^Q(a_0) \in \D$, $\g^R(a_0) = \g'^R(a_0)$ and for all $a \in A\setminus \set{a_0}$,  
	\begin{itemize}
		\item either $\g'(a) = \g(a)$
		
		\item or $\g'(a)$ is such that $\g^Q(a) \act{\rec(\a)} \g'^Q(a) \in \D$ with either
		\begin{itemize}
			\item $\a = *$ and $\g'^R(a) = \g^{R}(a)$
			\item $\a = \cp$ and $\g'^R(a) = m$
			\item $\a = \testeq$ and $\g'^R(a) = \g^R(a) =m$
		\end{itemize}
	\end{itemize}

	\AP A ""run"" is a sequence of transitions $\g_0 \act{m_0} \g_1 \act{m_1} \cdots \act{m_k} g_k$. We say that it is \emph{initial} if $g_0$ is an initial configuration.
\end{definition}

\begin{definition}
	A ""query"" is a set of formulas of the form $q(z)$, $R(z) = R(z')$, $R(z) \neq R(z')$, with $z, z'$ taken in a set of variables $Var$.
	It is \emph{satisfied} by a "configuration" $\g$ over a set of agents $A$ if there is a valuation $\nu : Var \to A$ such that:
	\begin{itemize}
		\item for all $q(z) \in \phi$, $\g_Q(\nu(z)) = q$
		
		\item for all $R(z) = R(z') \in \phi$, $\g_R(\nu(z)) = \g_R(\nu(z'))$
		
		\item for all $R(z) \neq R(z') \in \phi$, $\g_R(\nu(z)) \neq \g_R(\nu(z'))$
	\end{itemize}

	\AP The ""query coverability problem"" is to determine, given a "protocol" and a "query", whether there is an "initial run" of this protocol whose last "configuration" satisfies the query.
\end{definition}

\begin{ex}
	In some cases a protocol may require a "run" of exponential length (in the number of states) to reach a configuration satisfying a "query".
	
	\begin{figure}[h]
		\input{Figures/fig-exp-run}
		\label{fig:exp-run}
		\caption{Example of a "protocol" with a state that requires an exponentially long "run" to be covered.}
	\end{figure}
	
	\cortoin{TODO}
\end{ex}

\begin{proposition}
	The "query coverability problem" is \np-hard.
\end{proposition}

\begin{proof}
	\begin{figure}[h]
		\input{Figures/fig-np-hard}
		\label{fig:np-hard}
		\caption{The "protocol" used for the \np-hardness proof.}
	\end{figure}
	
	We reduce from the 3SAT problem.
	Let $x_1, \ldots, x_n$ be variables and $\phi = \bigwedge_{j=1}^m C_j$ with, for all $j$, $C_j = \ell_j^1 \lor \ell_j^2 \lor \ell_j^3$ and $\ell_j^1, \ell_j^2, \ell_j^3 \in \set{x_i, \neg x_i \mid 1 \leq i \leq n}$. 
	
	\cortoin{TODO}
\end{proof}


